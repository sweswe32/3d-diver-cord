1. Аппаратная часть (имитация в коде):
Ультразвуковые датчики:
В реальной системе датчики измеряют время прохождения сигнала от передатчика водолаза. В коде их работа имитируется через ручное управление позицией (перетаскивание) и глубиной (кнопки). Координаты датчиков могут быть заданы как опорные точки для трилатерации, но в текущей реализации используются напрямую для визуализации.

Передатчик водолаза:
Водолаз "несет" виртуальный передатчик, чьи координаты (X, Y, Z) обновляются через интерфейс. Глубина (Z) регулируется кнопками ▲ и ▼.

2. Алгоритм трилатерации (имитация):
Принцип работы:
В реальной системе позиция вычисляется по формуле трилатерации на основе расстояний до трех датчиков:

Copy
d_i = sqrt((x - x_i)^2 + (y - y_i)^2 + (z - z_i)^2)
где (x, y, z) — координаты водолаза, (x_i, y_i, z_i) — координаты датчиков.
В коде координаты водолаза обновляются вручную, что имитирует результат трилатерации.

Пример вычислений (псевдокод):

python
Copy
distances = [d1, d2, d3]  # Измеренные расстояния
3. Серверная часть:
Передача данных:
В реальной системе данные с датчиков отправляются на сервер для обработки. В коде это имитируется локальным обновлением состояния объекта Diver:

dart
Copy
void updatePosition(double dx, double dy) {
  _movementHistory.add(...);
  _position.x += dx;
  _position.y += dy;
  notifyListeners(); // Аналог отправки данных на сервер
}
API-интерфейс:
Для реальной интеграции можно использовать WebSocket или REST API для передачи данных в формате JSON:

json
Copy
{
  "x": 12.3,
  "y": 45.6,
  "z": 7.8,
  "timestamp": "2024-07-21T15:30:00Z"
}
4. Клиентская часть (веб-приложение):
Карта подводного пространства:
Реализована через CustomPaint с координатной сеткой. Нулевая точка (X=0, Y=0) — центр экрана, Y увеличивается вверх (декартова система):

dart
Copy
Offset toOffset(Size screenSize) => Offset(
  screenSize.width / 2 + x,
  screenSize.height / 2 - y, // Инверсия Y
);
Отображение данных в реальном времени:
Используется модель Diver с ChangeNotifier для мгновенного обновления UI при изменении координат:

dart
Copy
class Diver with ChangeNotifier {
  // При изменении позиции:
  notifyListeners(); // Перерисовывает UI
}
Интерфейс оператора:

Текущие координаты: Панель с X, Y, Z (см. _buildCoordinatePanel()).

Управление глубиной: Кнопки ▲/▼ для изменения Z (см. _buildDepthControls()).

Метки: Добавление контрольных точек (FAB-кнопки).

История: Страница /coordinates с журналом перемещений.

5. Дополнительные функции:
Сортировка меток:
Метки сортируются по времени добавления (кнопка в AppBar):

dart
Copy
_diver.markers.sort((a, b) => a.date.compareTo(b.date));
Очистка карты:
Сброс позиции водолаза в центр и удаление всех данных:

dart
Copy
void reset() {
  _position = Position(); // X=0, Y=0, Z=0
  _movementHistory.clear();
  notifyListeners();
}
6. Визуализация:
Траектория движения:
Линия пути рисуется через CustomPainter, соединяя предыдущие позиции:

dart
Copy
final path = Path();
path.moveTo(firstPos.x, firstPos.y);
path.lineTo(nextPos.x, nextPos.y);
canvas.drawPath(path, paint);
Глубина (Z):
Отображается численно и влияет на цвет меток (чем глубже, тем темнее):

dart
Copy
Paint()
  ..color = Colors.blue.withOpacity(1 - z / maxDepth);
Схема работы системы:
Copy
[Датчики] → [Сервер] → [Веб-приложение]
           (Трилатерация)    │
                             ├── Карта с позицией
                             ├── Глубина (Z)
                             └── История координат
Технологический стек:
Клиент: Flutter (Dart), CustomPaint для визуализации.

Сервер (имитация): Локальное состояние в Diver.

Реальная интеграция: Python/C++ для обработки данных, WebSocket для передачи.

Код представляет клиентскую часть системы мониторинга, где аппаратные компоненты и серверная логика имитируются для демонстрации. Для промышленного использования требуется интеграция с IoT-устройствами и backend.
